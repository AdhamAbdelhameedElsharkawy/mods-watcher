<Window x:Class="ModsWatcher.Desktop.Views.ModShellDialog"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:conv="clr-namespace:ModsWatcher.Desktop.Services"
        SizeToContent="Height"
        WindowStartupLocation="CenterOwner"
        Background="Transparent"
        AllowsTransparency="True"
        WindowStyle="None"
        Width="520">

    <Window.Resources>
        <BooleanToVisibilityConverter x:Key="BooleanToVisibilityConverter" />
        <conv:BoolToOpacityConverter x:Key="BoolToOpacityConverter" />
    </Window.Resources>

    <Border Background="{DynamicResource CardBackground}" BorderBrush="{DynamicResource BorderMuted}" BorderThickness="1" CornerRadius="12" Padding="25">
        <ScrollViewer VerticalScrollBarVisibility="Auto" MaxHeight="850">
            <StackPanel>
                <TextBlock Text="MOD IDENTITY" Style="{DynamicResource SectionHeaderStyle}"/>
                <TextBlock Text="{Binding DialogTitle}" Foreground="{DynamicResource TextPrimary}" FontSize="24" FontWeight="Bold" Margin="0,0,0,25"/>

                <TextBlock Text="Mod Name" Foreground="{DynamicResource TextSecondary}" FontSize="12" Margin="0,0,0,8"/>
                <TextBox Text="{Binding Name, UpdateSourceTrigger=PropertyChanged, ValidatesOnDataErrors=True}"/>

                <TextBlock Text="Author" Foreground="{DynamicResource TextSecondary}" FontSize="12" Margin="0,15,0,8"/>
                <TextBox Text="{Binding Author, UpdateSourceTrigger=PropertyChanged}"/>

                <TextBlock Text="Description" Foreground="{DynamicResource TextSecondary}" FontSize="12" Margin="0,15,0,8"/>
                <TextBox Text="{Binding Description, UpdateSourceTrigger=PropertyChanged}" 
                         AcceptsReturn="True" TextWrapping="Wrap" Height="80" VerticalScrollBarVisibility="Auto"/>

                <TextBlock Text="Root Source URL" Foreground="{DynamicResource TextSecondary}" FontSize="12" Margin="0,15,0,8"/>
                <TextBox Text="{Binding RootSourceUrl, UpdateSourceTrigger=PropertyChanged, ValidatesOnDataErrors=True}" Foreground="{DynamicResource AccentPrimary}"/>
                <TextBlock Text="The base URL where updates and version links are found." Foreground="{DynamicResource TextDisabled}" FontSize="10" Margin="0,5,0,20"/>

                <Separator Background="{DynamicResource BorderMuted}" Margin="0,0,0,20"/>

                <TextBlock Text="AUTOMATION CONTROLS" Style="{DynamicResource SectionHeaderStyle}"/>

                <CheckBox x:Name="UsedCheck" Content="Is Used (Active in App)" IsChecked="{Binding IsUsed}" Margin="0,5"/>

                <CheckBox x:Name="WatchCheck" Content="Is Watchable (Enable Stage 1)" 
                          IsChecked="{Binding IsWatchable}" 
                          IsEnabled="{Binding IsChecked, ElementName=UsedCheck}"
                          Opacity="{Binding IsEnabled, RelativeSource={RelativeSource Self}, Converter={StaticResource BoolToOpacityConverter}}"
                          Margin="20,5,0,5"/>

                <CheckBox x:Name="CrawlCheck" Content="Is Crawlable (Enable Stage 2 &amp; 3)" 
                          IsChecked="{Binding IsCrawlable}" 
                          IsEnabled="{Binding IsChecked, ElementName=WatchCheck}"
                          Opacity="{Binding IsEnabled, RelativeSource={RelativeSource Self}, Converter={StaticResource BoolToOpacityConverter}}"
                          Margin="40,5,0,20"/>

                <StackPanel Visibility="{Binding IsWatchable, Converter={StaticResource BooleanToVisibilityConverter}}">
                    <Border Background="{DynamicResource AccentStage1}" Style="{DynamicResource StageBorderStyle}">
                        <StackPanel>
                            <TextBlock Text="STAGE 1: WATCHER (HASH TRACKING)" FontSize="10" FontWeight="Bold" Foreground="{DynamicResource AccentPrimary}" Margin="0,0,0,10"/>
                            <TextBlock Text="Watcher XPath" Foreground="{DynamicResource TextSecondary}" FontSize="11" Margin="0,0,0,5"/>
                            <TextBox Text="{Binding WatcherXPath, UpdateSourceTrigger=PropertyChanged, ValidatesOnDataErrors=True}" Background="{DynamicResource WindowBackground}"/>
                            <TextBlock Text="Identifies the element to monitor for changes." Foreground="{DynamicResource TextDisabled}" FontSize="9" Margin="0,5,0,0"/>
                        </StackPanel>
                    </Border>
                </StackPanel>

                <StackPanel Visibility="{Binding IsCrawlable, Converter={StaticResource BooleanToVisibilityConverter}}">
                    <Border Background="{DynamicResource AccentStage2}" Style="{DynamicResource StageBorderStyle}">
                        <StackPanel>
                            <TextBlock Text="STAGE 2: LINK DISCOVERY" FontSize="10" FontWeight="Bold" Foreground="#9C27B0" Margin="0,0,0,10"/>
                            <TextBlock Text="Links Regex for filteration" Foreground="{DynamicResource TextSecondary}" FontSize="11" Margin="0,0,0,5"/>
                            <TextBox Text="{Binding ModNameRegex, UpdateSourceTrigger=PropertyChanged}" Background="{DynamicResource WindowBackground}" Margin="0,0,0,15"/>

                            <TextBlock Text="STAGE 3: DATA SCRAPER (AUTO-FILL)" FontSize="10" FontWeight="Bold" Foreground="{DynamicResource AccentSuccess}" Margin="0,0,0,10"/>
                            <UniformGrid Columns="2">
                                <StackPanel Margin="0,0,5,10">
                                    <TextBlock Text="Version XPath" Foreground="{DynamicResource TextMuted}" FontSize="10" Margin="0,0,0,4"/>
                                    <TextBox Text="{Binding VersionXPath}" Background="{DynamicResource WindowBackground}"/>
                                </StackPanel>
                                <StackPanel Margin="5,0,0,10">
                                    <TextBlock Text="Download URL XPath" Foreground="{DynamicResource TextMuted}" FontSize="10" Margin="0,0,0,4"/>
                                    <TextBox Text="{Binding DownloadUrlXPath}" Background="{DynamicResource WindowBackground}"/>
                                </StackPanel>
                                <StackPanel Margin="0,0,5,10">
                                    <TextBlock Text="Size XPath" Foreground="{DynamicResource TextMuted}" FontSize="10" Margin="0,0,0,4"/>
                                    <TextBox Text="{Binding SizeXPath}" Background="{DynamicResource WindowBackground}"/>
                                </StackPanel>
                                <StackPanel Margin="5,0,0,10">
                                    <TextBlock Text="Release Date XPath" Foreground="{DynamicResource TextMuted}" FontSize="10" Margin="0,0,0,4"/>
                                    <TextBox Text="{Binding ReleaseDateXPath}" Background="{DynamicResource WindowBackground}"/>
                                </StackPanel>
                            </UniformGrid>
                        </StackPanel>
                    </Border>
                </StackPanel>

                <Grid Margin="0,15,0,0">
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="*"/>
                        <ColumnDefinition Width="*"/>
                    </Grid.ColumnDefinitions>
                    <Button Content="Cancel" Command="{Binding CancelCommand}" Style="{DynamicResource ActionIconButtonStyle}" Foreground="{DynamicResource TextSecondary}" Height="42"/>
                    <Button Grid.Column="1" Content="Save Identity &amp; Config" Command="{Binding SaveCommand}" 
                            Background="{DynamicResource AccentPrimary}" Foreground="{DynamicResource TextPrimary}" Height="42" FontWeight="Bold"/>
                </Grid>
            </StackPanel>
        </ScrollViewer>
    </Border>
</Window>